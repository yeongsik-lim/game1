<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lucky 7 Mobile Slot</title>
    <!-- Tailwind CSS for Layout -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Russo One', sans-serif;
            background-color: #1a1a1a;
            overflow: hidden; /* Prevent scrolling on mobile */
            touch-action: manipulation;
        }

        /* Neon Glow Effects */
        .neon-text {
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #ff00de, 0 0 30px #ff00de;
        }
        .machine-border {
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8), 0 0 15px #ffcc00;
            border: 4px solid #facc15;
        }

        /* Reel Styles */
        .reel-container {
            background: linear-gradient(to bottom, #000 0%, #222 20%, #333 50%, #222 80%, #000 100%);
            box-shadow: inset 0 0 10px #000;
            overflow: hidden;
            perspective: 1000px;
            position: relative;
        }
        
        .reel-strip {
            font-size: 3rem;
            line-height: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* Initial position centered */
            transform: translateY(0);
        }

        /* Blur effect while spinning */
        .spinning .reel-strip {
            filter: blur(4px);
        }

        /* Win Animation */
        @keyframes winPulse {
            0% { transform: scale(1); filter: brightness(100%); }
            50% { transform: scale(1.1); filter: brightness(150%); }
            100% { transform: scale(1); filter: brightness(100%); }
        }
        .win-anim {
            animation: winPulse 0.5s ease-in-out infinite;
            color: #ffd700;
            text-shadow: 0 0 10px #ffd700;
        }

        /* Button Press Effect */
        .btn-press:active {
            transform: translateY(4px);
            box-shadow: 0 0 5px #000;
        }

        /* Payline */
        .payline {
            position: absolute;
            top: 50%;
            left: -10px;
            right: -10px;
            height: 4px;
            background: rgba(255, 0, 0, 0.4);
            z-index: 10;
            pointer-events: none;
            box-shadow: 0 0 5px red;
        }
    </style>
</head>
<body class="h-screen w-full flex items-center justify-center bg-gray-900 text-white">

    <!-- Main Machine Casing -->
    <div class="relative w-full max-w-md bg-purple-900 rounded-3xl p-4 m-2 machine-border flex flex-col gap-4 shadow-2xl">
        
        <!-- Header / Logo -->
        <div class="text-center">
            <h1 class="text-3xl text-yellow-400 tracking-wider uppercase neon-text">Mega Win 777</h1>
        </div>

        <!-- Status Display -->
        <div class="flex justify-between bg-black rounded-lg p-2 border-2 border-gray-600 text-sm sm:text-base">
            <div class="text-blue-300">CREDITS: <span id="credits" class="text-white font-mono text-lg">1000</span></div>
            <div class="text-green-300">WIN: <span id="last-win" class="text-white font-mono text-lg">0</span></div>
        </div>

        <!-- Reels Area -->
        <div class="relative grid grid-cols-3 gap-2 bg-black p-2 rounded-xl border-4 border-yellow-600 h-48 items-center">
            <!-- Payline indicator -->
            <div class="payline"></div>

            <!-- Reel 1 -->
            <div class="reel-container h-full rounded-lg relative flex justify-center items-center" id="reel1">
                <div class="reel-strip" id="strip1">üçí</div>
            </div>
            <!-- Reel 2 -->
            <div class="reel-container h-full rounded-lg relative flex justify-center items-center" id="reel2">
                <div class="reel-strip" id="strip2">üçã</div>
            </div>
            <!-- Reel 3 -->
            <div class="reel-container h-full rounded-lg relative flex justify-center items-center" id="reel3">
                <div class="reel-strip" id="strip3">üçá</div>
            </div>
        </div>

        <!-- Controls -->
        <div class="flex flex-col gap-3">
            <!-- Bet Controls -->
            <div class="flex justify-center items-center gap-4">
                <button onclick="adjustBet(-10)" class="bg-gray-700 text-white w-10 h-10 rounded-full border-2 border-gray-500 btn-press">-</button>
                <div class="bg-black px-4 py-2 rounded border border-gray-600">
                    <span class="text-gray-400 text-xs block text-center">BET</span>
                    <span id="bet-amount" class="text-xl font-mono text-yellow-400">10</span>
                </div>
                <button onclick="adjustBet(10)" class="bg-gray-700 text-white w-10 h-10 rounded-full border-2 border-gray-500 btn-press">+</button>
            </div>

            <!-- Spin Button -->
            <button id="spin-btn" class="w-full bg-gradient-to-b from-red-500 to-red-700 hover:from-red-400 hover:to-red-600 text-white text-2xl py-4 rounded-xl border-b-8 border-red-900 shadow-lg btn-press transition-all disabled:opacity-50 disabled:cursor-not-allowed uppercase tracking-widest">
                SPIN
            </button>
        </div>

        <!-- Footer -->
        <div class="text-center text-gray-500 text-xs mt-2">
            HTML5 CASINO ‚Ä¢ SOUND ON üîä
        </div>
    </div>

    <!-- Modal for Game Over / Big Win -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-90 hidden flex items-center justify-center z-50">
        <div class="bg-purple-800 p-8 rounded-2xl text-center border-4 border-yellow-400 animate-bounce">
            <h2 id="modal-title" class="text-4xl text-yellow-300 mb-4 neon-text">JACKPOT!</h2>
            <p id="modal-message" class="text-white mb-6">You won 500 credits!</p>
            <button onclick="closeModal()" class="bg-green-500 text-white px-6 py-2 rounded-lg font-bold shadow-lg btn-press">
                CONTINUE
            </button>
        </div>
    </div>

    <script>
        /**
         * CONFIGURATION & STATE
         */
        const symbols = ['üçí', 'üçã', 'üçá', 'üçâ', 'üîî', 'üíé', '7Ô∏è‚É£'];
        // Weights: Higher index = rarer. Simple weighted random.
        // 7 is rarest, Cherry is most common.
        const weights = [0, 0, 0, 1, 1, 2, 2, 3, 4, 5, 6]; 
        
        let credits = 1000;
        let currentBet = 10;
        let isSpinning = false;
        let audioContext = null;

        // DOM Elements
        const reels = [
            document.getElementById('strip1'),
            document.getElementById('strip2'),
            document.getElementById('strip3')
        ];
        const reelContainers = [
            document.getElementById('reel1'),
            document.getElementById('reel2'),
            document.getElementById('reel3')
        ];
        const elCredits = document.getElementById('credits');
        const elBet = document.getElementById('bet-amount');
        const elLastWin = document.getElementById('last-win');
        const btnSpin = document.getElementById('spin-btn');
        const modal = document.getElementById('modal');

        /**
         * SOUND ENGINE (Web Audio API)
         * Generates sounds synthetically to avoid external file dependencies.
         */
        const Sound = {
            init: () => {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            },
            playTone: (freq, type, duration, vol = 0.1) => {
                if (!audioContext) return;
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, audioContext.currentTime);
                gain.gain.setValueAtTime(vol, audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.start();
                osc.stop(audioContext.currentTime + duration);
            },
            spin: () => {
                // Rapid clicking sound
                Sound.playTone(150, 'square', 0.1, 0.05);
            },
            stop: () => {
                // Heavy clunk
                Sound.playTone(100, 'sawtooth', 0.2, 0.2);
            },
            win: () => {
                // High pitched ding
                Sound.playTone(800, 'sine', 0.3, 0.2);
                setTimeout(() => Sound.playTone(1200, 'sine', 0.4, 0.2), 150);
            },
            jackpot: () => {
                // Fanfare
                const now = audioContext.currentTime;
                [0, 0.2, 0.4, 0.6, 0.8].forEach((t, i) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.frequency.value = 400 + (i * 100);
                    osc.type = 'triangle';
                    gain.gain.value = 0.2;
                    gain.gain.exponentialRampToValueAtTime(0.01, now + t + 0.5);
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    osc.start(now + t);
                    osc.stop(now + t + 0.5);
                });
            }
        };

        /**
         * GAME LOGIC
         */
        function adjustBet(amount) {
            if (isSpinning) return;
            let newBet = currentBet + amount;
            if (newBet >= 10 && newBet <= 100 && newBet <= credits) {
                currentBet = newBet;
                updateUI();
            }
            Sound.init();
            Sound.playTone(400, 'sine', 0.1);
        }

        function getRandomSymbol() {
            // Simple weighted random logic
            const randIndex = Math.floor(Math.random() * weights.length);
            const symbolIndex = weights[randIndex];
            return symbols[symbolIndex];
        }

        function updateUI() {
            elCredits.innerText = credits;
            elBet.innerText = currentBet;
            // Enable/Disable spin button based on credits
            if (credits < currentBet) {
                btnSpin.disabled = true;
                btnSpin.innerText = "GAME OVER";
                btnSpin.classList.add('bg-gray-600');
                btnSpin.classList.remove('from-red-500');
            } else {
                btnSpin.disabled = false;
                btnSpin.classList.remove('bg-gray-600');
                btnSpin.classList.add('from-red-500');
            }
        }

        async function spin() {
            if (isSpinning || credits < currentBet) return;
            
            Sound.init(); // Initialize audio on user interaction
            isSpinning = true;
            credits -= currentBet;
            elLastWin.innerText = "0";
            elLastWin.classList.remove('text-yellow-400', 'neon-text');
            updateUI();
            
            // Visual State: Spinning
            btnSpin.disabled = true;
            btnSpin.innerText = "SPINNING...";
            reelContainers.forEach(el => {
                el.classList.add('spinning');
                el.classList.remove('win-anim'); // Remove previous win anim
            });

            // Determine Results BEFORE animation finishes
            const finalSymbols = [getRandomSymbol(), getRandomSymbol(), getRandomSymbol()];

            // Animation Sequence
            const spinDuration = 2000; // Total time
            const spinIntervals = [];

            // Start visual spinning effect (rapidly changing symbols)
            reels.forEach((reel, index) => {
                const interval = setInterval(() => {
                    reel.innerText = symbols[Math.floor(Math.random() * symbols.length)];
                    // Play tick sound randomly to save performance
                    if(Math.random() > 0.5) Sound.spin(); 
                }, 100);
                spinIntervals.push(interval);
            });

            // Stop reels one by one
            for (let i = 0; i < 3; i++) {
                await new Promise(resolve => setTimeout(resolve, 500 + (i * 500))); // Staggered stop
                
                clearInterval(spinIntervals[i]); // Stop random flipping
                reelContainers[i].classList.remove('spinning'); // Remove blur
                reels[i].innerText = finalSymbols[i]; // Set final symbol
                
                // "Bounce" animation effect for landing
                reels[i].style.transform = "translateY(-20px)";
                setTimeout(() => reels[i].style.transform = "translateY(0)", 150);
                
                Sound.stop();
            }

            checkWin(finalSymbols);
            isSpinning = false;
            btnSpin.disabled = false;
            btnSpin.innerText = "SPIN";
            updateUI();
        }

        function checkWin(results) {
            const [s1, s2, s3] = results;
            let winAmount = 0;
            let isWin = false;

            // Logic: 3 match, or 2 match (simplified)
            if (s1 === s2 && s2 === s3) {
                // 3 Match
                isWin = true;
                let multiplier = 10; // Default fruit
                if (s1 === '7Ô∏è‚É£') multiplier = 100; // Jackpot
                else if (s1 === 'üíé') multiplier = 50;
                else if (s1 === 'üîî') multiplier = 20;
                
                winAmount = currentBet * multiplier;
                
                // Highlight all
                reelContainers.forEach(el => el.classList.add('win-anim'));
                showModal("BIG WIN!", `+${winAmount} CREDITS`, true);
                Sound.jackpot();

            } else if (s1 === s2 || s2 === s3 || s1 === s3) {
                // 2 Match (Simple win)
                isWin = true;
                winAmount = currentBet * 2;
                elLastWin.classList.add('text-yellow-400', 'neon-text');
                Sound.win();
            }

            if (isWin) {
                credits += winAmount;
                elLastWin.innerText = winAmount;
                // Pulse logic for visual feedback
                elCredits.classList.add('text-yellow-400');
                setTimeout(() => elCredits.classList.remove('text-yellow-400'), 1000);
            }
        }

        function showModal(title, msg, isJackpot) {
            const modalTitle = document.getElementById('modal-title');
            const modalMsg = document.getElementById('modal-message');
            
            modalTitle.innerText = title;
            modalMsg.innerText = msg;
            modal.classList.remove('hidden');
            
            if(isJackpot) {
                // Confetti effect could go here, simplified for single file
                modalTitle.style.color = "#facc15";
            }
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        // Event Listeners
        btnSpin.addEventListener('click', spin);

        // Initialize
        updateUI();

    </script>
</body>
</html>

